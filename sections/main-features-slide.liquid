<div class="full-bleed min-h-[900px] flex flex-col py-5 px-5 sm:px-20 lg:px-5 xl:px-20 md:pb-20">
    
    <div class="w-full text-center mb-8 pb-10">
        <h2 class="text-2xl md:text-4xl font-bold text-gray-900">
            {{ section.settings.title }}
        </h2>
    </div>

    <!-- Botones de features -->
    <div class="w-full flex flex-wrap justify-center mb-12 md:pb-10 pb-5">
        {% for block in section.blocks %}
            <button class="feature-btn px-7 sm:px-10 md:px-15 lg:px-6 py-2 transition-all duration-300 xl:text-lg flex items-center gap-2
                           {% if forloop.first %}bg-gray-200 text-black{% else %}bg-white 
                            text-gray-700{% endif %}"
                    data-feature="{{ block.id }}"
                    data-index="{{ forloop.index0 }}"
                    {{ block.shopify_attributes }}>
                
                <!-- Logo -->
                {% if block.settings.feature_image %}
                    <img src="{{ block.settings.feature_image | image_url: width: 100 }}"
                         class="w-6 h-6 object-contain"
                         width="{{ block.settings.feature_image.width }}"
                         height="{{ block.settings.feature_image.height }}"
                         alt="{{ block.settings.feature_name }}">
                {% endif %}
                
                <!-- Texto - oculto en mobile -->
                <span class="hidden lg:inline">{{ block.settings.feature_name }}</span>
            </button>
        {% endfor %}
    </div>

    <!-- Desktop Layout -->
    <div class="hidden lg:flex w-full flex-row gap-10 lg:gap-20 relative px-25">
        
        <!-- Lado izquierdo: Contenido de texto -->
        <div class="w-full lg:w-1/2 flex flex-col justify-center">
            {% for block in section.blocks %}
                <div class="feature-content max-w-200 pl-10 {% unless forloop.first %}hidden{% endunless %}" 
                     data-content="{{ block.id }}">
                    
                    <h3 class="text-xl md:text-4xl font-bold mb-3 text-gray-900 py-4">
                        {{ block.settings.title }}
                    </h3>
                    
                    <p class="text-lg md:text-xl text-gray-600 mb-4">
                        {{ block.settings.subtitle }}
                    </p>
                    
                    <div class="text-base text-gray-700 leading-relaxed">
                        {{ block.settings.description }}
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Lado derecho: Imágenes -->
        <div class="w-full lg:w-1/2 flex items-center justify-center">
            {% for block in section.blocks %}
                <div class="feature-image w-full h-[400px] lg:h-[600px] rounded-2xl overflow-hidden {% unless forloop.first %}hidden{% endunless %}"
                     data-image="{{ block.id }}">
                    {% if block.settings.image_banner %}
                        <img src="{{ block.settings.image_banner | image_url: width: 1200 }}"
                             class="min-w-full min-h-full object-cover"
                             width="{{ block.settings.image_banner.width }}"
                             height="{{ block.settings.image_banner.height }}"
                             alt="{{ block.settings.title }}">
                    {% else %}
                        <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                            <span class="text-gray-400">No image</span>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

        <!-- Flechas de navegación - Desktop -->
        <div class="absolute inset-0 flex justify-between items-center pointer-events-none px-4">
            <button class="feature-prev-btn pointer-events-auto 
                rounded-full transition-all duration-300 text-2xl lg:text-4xl text-gray-800">
                ‹
            </button>
            <button class="feature-next-btn pointer-events-auto 
                rounded-full transition-all duration-300 text-2xl lg:text-4xl text-gray-800">
                ›
            </button>
        </div>

    </div>

    <!-- Mobile Layout -->
    <div class="lg:hidden w-full flex flex-col relative px-5">
        
        {% for block in section.blocks %}
            <div class="feature-mobile-content {% unless forloop.first %}hidden{% endunless %}" 
                 data-mobile-content="{{ block.id }}">
                
                <!-- Título -->
                <h3 class="text-lg font-bold mb-6 text-gray-900 text-center px-4 py-3">
                    {{ block.settings.title }}
                </h3>
                
                <!-- Imagen -->
                <div class="w-full sm:h-[500px] h-[400px] rounded-2xl overflow-hidden mb-6">
                    {% if block.settings.image_banner %}
                        <img src="{{ block.settings.image_banner | image_url: width: 800 }}"
                             class="w-full h-full object-cover"
                             width="{{ block.settings.image_banner.width }}"
                             height="{{ block.settings.image_banner.height }}"
                             alt="{{ block.settings.title }}">
                    {% else %}
                        <div class="w-full h-full bg-gray-200 flex items-center justify-center">
                            <span class="text-gray-400">No image</span>
                        </div>
                    {% endif %}
                </div>

                <!-- Descripción -->
                <div class="px-4 py-5">
                    <p class="text-lg text-gray-600 mb-4">
                        {{ block.settings.subtitle }}
                    </p>
                    
                    <div class="text-base text-gray-700 leading-relaxed">
                        {{ block.settings.description }}
                    </div>
                </div>
            </div>
        {% endfor %}

        

    </div>

</div>

<style>
.full-bleed{
  width: 100vw;
  margin-left: calc(50% - 50vw);
  margin-right: calc(50% - 50vw);
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const featureBtns = document.querySelectorAll(".feature-btn");
    const featureContents = document.querySelectorAll(".feature-content");
    const featureImages = document.querySelectorAll(".feature-image");
    const featureMobileContents = document.querySelectorAll(".feature-mobile-content");
    
    const prevBtn = document.querySelector(".feature-prev-btn");
    const nextBtn = document.querySelector(".feature-next-btn");
    const prevBtnMobile = document.querySelector(".feature-prev-btn-mobile");
    const nextBtnMobile = document.querySelector(".feature-next-btn-mobile");
    
    let currentIndex = 0;
    const totalFeatures = featureBtns.length;

    function showFeature(index) {
        const targetBtn = featureBtns[index];
        const featureId = targetBtn.dataset.feature;

        // Cambiar estilos de botones
        featureBtns.forEach(b => {
            b.classList.remove("bg-gray-200", "text-black");
            b.classList.add("bg-white", "text-gray-700");
        });

        targetBtn.classList.remove("bg-white", "text-gray-700");
        targetBtn.classList.add("bg-gray-200", "text-black");

        // Mostrar contenido correspondiente - Desktop
        featureContents.forEach(content => {
            if (content.dataset.content === featureId) {
                content.classList.remove("hidden");
            } else {
                content.classList.add("hidden");
            }
        });

        // Mostrar imagen correspondiente - Desktop
        featureImages.forEach(image => {
            if (image.dataset.image === featureId) {
                image.classList.remove("hidden");
            } else {
                image.classList.add("hidden");
            }
        });

        // Mostrar contenido correspondiente - Mobile
        featureMobileContents.forEach(content => {
            if (content.dataset.mobileContent === featureId) {
                content.classList.remove("hidden");
            } else {
                content.classList.add("hidden");
            }
        });

        currentIndex = index;
    }

    // Click en botones de features
    featureBtns.forEach((btn, index) => {
        btn.addEventListener("click", function () {
            showFeature(index);
        });
    });

    // Navegación con flechas - Desktop
    nextBtn?.addEventListener("click", function () {
        const newIndex = (currentIndex + 1) % totalFeatures;
        showFeature(newIndex);
    });

    prevBtn?.addEventListener("click", function () {
        const newIndex = (currentIndex - 1 + totalFeatures) % totalFeatures;
        showFeature(newIndex);
    });

    // Navegación con flechas - Mobile
    nextBtnMobile?.addEventListener("click", function () {
        const newIndex = (currentIndex + 1) % totalFeatures;
        showFeature(newIndex);
    });

    prevBtnMobile?.addEventListener("click", function () {
        const newIndex = (currentIndex - 1 + totalFeatures) % totalFeatures;
        showFeature(newIndex);
    });
});
</script>

{% schema %}
{
  "name": "Features",
  "settings": [ 
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Loved by everyone, everywhere. Don't miss out"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature",
      "settings": [
        {
          "type": "text",
          "id": "feature_name",
          "label": "Feature name (Button text)", 
          "default": "Feature 1"
        },
        {
          "type": "image_picker",
          "id": "feature_image",
          "label": "Feature icon/logo"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title", 
          "default": "What makes it special?"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle", 
          "default": "Subtitle"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description", 
          "default": "<p>Description</p>"
        },
        {
          "type": "image_picker",
          "id": "image_banner",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Features",
      "category": "main"
    }
  ]
}
{% endschema %}